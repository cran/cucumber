<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Behavior-Driven Development</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
width: 0.8em;
margin: 0 0.8em 0.2em -1em;  vertical-align: middle;
}
.display.math{display: block; text-align: center; margin: 0.5rem auto;}

pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>




<style type="text/css">body {background-color: #fff;margin: 1em auto;max-width: 700px;overflow: visible;padding-left: 2em;padding-right: 2em;font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;font-size: 14px;line-height: 1.35;}table {margin: 1em auto;border-width: 1px;border-color: #DDDDDD;border-style: outset;border-collapse: collapse;}table th {border-width: 2px;padding: 5px;border-style: inset;}table td {border-width: 1px;border-style: inset;line-height: 18px;padding: 5px 5px;}table, table th, table td {border-left-style: none;border-right-style: none;}table thead, table tr.even {background-color: #f7f7f7;}p {margin: 0.5em 0;}blockquote {background-color: #f6f6f6;padding: 0.25em 0.75em;}hr {border-style: solid;border: none;border-top: 1px solid #777;margin: 28px 0;}dl {margin-left: 0;}dl dd {margin-bottom: 13px;margin-left: 13px;}dl dt {font-weight: bold;}ul {margin-top: 0;}ul li {list-style: circle outside;}ul ul {margin-bottom: 0;}pre, code {background-color: #f7f7f7;border-radius: 3px;color: #333;white-space: pre-wrap; }pre {border-radius: 3px;margin: 5px 0px 10px 0px;padding: 10px;}pre:not([class]) {background-color: #f7f7f7;}code {font-family: Consolas, Monaco, 'Courier New', monospace;font-size: 85%;}p > code, li > code {padding: 2px 0px;}div.figure {text-align: center;}img {background-color: #FFFFFF;padding: 2px;border: 1px solid #DDDDDD;border-radius: 3px;border: 1px solid #CCCCCC;margin: 0 5px;}h1 {margin-top: 0;font-size: 35px;line-height: 40px;}h2 {border-bottom: 4px solid #f7f7f7;padding-top: 10px;padding-bottom: 2px;font-size: 145%;}h3 {border-bottom: 2px solid #f7f7f7;padding-top: 10px;font-size: 120%;}h4 {border-bottom: 1px solid #f7f7f7;margin-left: 8px;font-size: 105%;}h5, h6 {border-bottom: 1px solid #ccc;font-size: 105%;}a {color: #0033dd;text-decoration: none;}a:hover {color: #6666ff; }a:visited {color: #800080; }a:visited:hover {color: #BB00BB; }a[href^="http:"] {text-decoration: underline; }a[href^="https:"] {text-decoration: underline; }</style>
</head>

<body>


<header id="title-block-header">
<h1 class="title">Behavior-Driven Development</h1>

</header>


<p>When developing software, a disconnect between what users want and what the software does can occur. We might‚Äôve delivered working, tested code, but does it solve the user‚Äôs problem?</p>
<p>Behavior-driven development aims to mitigate that risk, by capturing and testing requirements from the perspective of the external user of the system.</p>
<h2 id="how-bdd-works">How BDD works</h2>
<p>Whether we‚Äôre working with a Product Owner, with users, or by ourselves, BDD can help us explore and define the problem in a structured way.</p>
<p>The process is as follows:</p>
<ol type="1">
<li>We capture a vague wish with a User Story.</li>
<li>We refine the User Story into examples. Those examples describe how we can tell if the wish has been fulfilled. Focus on what you want to achieve, not how to achieve it.</li>
<li>We create specifications. They are direct translations of examples into code.</li>
</ol>
<p>This helps us move from a vague description to a very precise, testable specification.</p>
<h2 id="capturing-a-wish-with-a-user-story">Capturing a wish with a User Story</h2>
<p>Let‚Äôs imagine we want to implement a bookstore. The first User Story could be:</p>
<blockquote>
<p>As a customer, I want to select a book and add it to cart so that I can buy it.</p>
</blockquote>
<h2 id="refining-the-user-story-into-examples">Refining the User Story into examples</h2>
<p>Behavior-Driven Development helps us focus on behavior, by using a language that expresses behavior:</p>
<ul>
<li><strong>Given</strong> some context,</li>
<li><strong>When</strong> an event occurs,</li>
<li><strong>Then</strong> an outcome should be observed.</li>
</ul>
<p>In this example, we could write:</p>
<ul>
<li>Given I am in the bookstore</li>
<li>When I select ‚ÄúThe Hobbit, J.R.R. Tolkien‚Äù</li>
<li>When I add selected book to the cart</li>
<li>Then I should see ‚ÄúThe Hobbit, J.R.R. Tolkien‚Äù in the cart</li>
</ul>
<p>This description is more precise than the User Story. It describes what needs to happen, what the user needs to do, and what result the user should see.</p>
<p>At this level, we don‚Äôt know anything about the implementation of the bookstore. This description fits any implementation of the bookstore:</p>
<ul>
<li>it could be a web application,</li>
<li>it could be a CLI application,</li>
<li>or it could be a physical store with a robot assistant.</li>
</ul>
<p>The implementation can be changed at any moment, and executing the specification should tell us if the system allows the user to achieve their goal.</p>
<h2 id="implementing-executable-specifications">Implementing executable specifications</h2>
<p>Specifications implemented with Behavior-Driven Development are:</p>
<ul>
<li>instantly readable,</li>
<li>focused on the business goal,</li>
<li>hiding the implementation details,</li>
<li>encouraging reuse of test code.</li>
</ul>
<p>Behavior-Driven Development is not about tools. It‚Äôs a way of building software. We can implement specifications in any way we want, however, there are tools that can help us. {cucumber} is one of them.</p>
<h1 id="bdd-with-base-r">BDD with base R</h1>
<p>We can practice BDD using base R. Having a set of examples of how the system should work, we need to establish a way of translating examples to code.</p>
<p>We need to represent the business language with code ‚Äì a set of actions that user of the system can take. We can do it with functions. Those functions will create the interface of the system. Their names can follow closely the natural language description of the action. They will abstract and hide the implementation details of the system. They will allow reuse of the test code.</p>
<p>The specification of the bookstore could look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tests/testthat/test-bookstore.R</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;Bookstore: Adding a book to cart&quot;</span>, {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Given</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  bookstore <span class="ot">&lt;-</span> Bookstore<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># When</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  bookstore<span class="sc">$</span><span class="fu">select</span>(<span class="st">&quot;The Hobbit, J.R.R. Tolkien&quot;</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  bookstore<span class="sc">$</span><span class="fu">add_to_cart</span>()</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Then</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  bookstore<span class="sc">$</span><span class="fu">cart_includes</span>(<span class="st">&quot;The Hobbit, J.R.R. Tolkien&quot;</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ‚îÄ‚îÄ Error: Bookstore: Adding a book to cart ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in `eval(code, test_env)`: object &#39;Bookstore&#39; not found</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error:</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ! Test failed</span></span></code></pre></div>
</div>
<p>This test fails as the code doesn‚Äôt exist yet. We can pause in this step and try out a few versions of the specifications and go with one that expresses the business goal the best.</p>
<p>Once we have an outline of actions, we can implement them. We can use R6 objects to bind the functions together.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tests/testthat/setup-bookstore.R</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Bookstore <span class="ot">&lt;-</span> R6<span class="sc">::</span><span class="fu">R6Class</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">select =</span> <span class="cf">function</span>(title) {</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">add_to_cart =</span> <span class="cf">function</span>() {</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cart_includes =</span> <span class="cf">function</span>(title) {</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<p>When we have a skeleton of the implementation, we can start filling it with the actual code.</p>
<p>For example, our implementation of the bookstore might be a package with:</p>
<ul>
<li><code>select_book</code>: function that returns a tibble with book details,</li>
<li><code>add_to_cart</code>: function that adds a book with given ID to a storage,</li>
<li><code>get_cart</code>: function that returns a list with details of books in the cart.</li>
</ul>
<p>An implementation that satisfies the specification could be as simple as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>storage <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>books <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">id =</span> <span class="dv">1</span>, <span class="at">title =</span> <span class="st">&quot;The Hobbit, J.R.R. Tolkien&quot;</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">id =</span> <span class="dv">2</span>, <span class="at">title =</span> <span class="st">&quot;The Lord of the Rings, J.R.R. Tolkien&quot;</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>select_book <span class="ot">&lt;-</span> <span class="cf">function</span>(title) {</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  books <span class="sc">|&gt;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">keep</span>(\(x) x<span class="sc">$</span>title <span class="sc">==</span> title) <span class="sc">|&gt;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>add_to_cart <span class="ot">&lt;-</span> <span class="cf">function</span>(id) {</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  storage <span class="ot">&lt;&lt;-</span> <span class="fu">c</span>(storage, id)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>get_cart <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  books <span class="sc">|&gt;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">keep</span>(\(x) x<span class="sc">$</span>id <span class="sc">%in%</span> storage)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>Having this implementation, we can plug it into the test code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tests/testthat/setup-bookstore.R</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Bookstore <span class="ot">&lt;-</span> R6<span class="sc">::</span><span class="fu">R6Class</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">private =</span> <span class="fu">list</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">selected_id =</span> <span class="cn">NULL</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">select =</span> <span class="cf">function</span>(title) {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      private<span class="sc">$</span>selected_id <span class="ot">&lt;-</span> <span class="fu">select_book</span>(title)<span class="sc">$</span>id</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">add_to_cart =</span> <span class="cf">function</span>() {</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_to_cart</span>(private<span class="sc">$</span>selected_id)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">cart_includes =</span> <span class="cf">function</span>(title) {</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>      testthat<span class="sc">::</span><span class="fu">expect_in</span>(title, purrr<span class="sc">::</span><span class="fu">map_chr</span>(<span class="fu">get_cart</span>(), <span class="st">&quot;title&quot;</span>))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<p>Now, the tests pass.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tests/testthat/test-bookstore.R</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;Bookstore: Adding a book to cart&quot;</span>, {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Given</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  bookstore <span class="ot">&lt;-</span> Bookstore<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># When</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  bookstore<span class="sc">$</span><span class="fu">select</span>(<span class="st">&quot;The Hobbit, J.R.R. Tolkien&quot;</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  bookstore<span class="sc">$</span><span class="fu">add_to_cart</span>()</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Then</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  bookstore<span class="sc">$</span><span class="fu">cart_includes</span>(<span class="st">&quot;The Hobbit, J.R.R. Tolkien&quot;</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Test passed ü•≥</span></span></code></pre></div>
</div>
<p>With this implementation, we can easily extend tests with checking if we can add multiple books to the cart.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;Bookstore: Adding multiple books to cart&quot;</span>, {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Given</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  bookstore <span class="ot">&lt;-</span> Bookstore<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># When</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  bookstore<span class="sc">$</span><span class="fu">select</span>(<span class="st">&quot;The Hobbit, J.R.R. Tolkien&quot;</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  bookstore<span class="sc">$</span><span class="fu">add_to_cart</span>()</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  bookstore<span class="sc">$</span><span class="fu">select</span>(<span class="st">&quot;The Lord of the Rings, J.R.R. Tolkien&quot;</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  bookstore<span class="sc">$</span><span class="fu">add_to_cart</span>()</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Then</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  bookstore<span class="sc">$</span><span class="fu">cart_includes</span>(<span class="fu">c</span>(<span class="st">&quot;The Hobbit, J.R.R. Tolkien&quot;</span>, <span class="st">&quot;The Lord of the Rings, J.R.R. Tolkien&quot;</span>))</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Test passed ü•≥</span></span></code></pre></div>
</div>
<p>As the system grows, it will be extended with more examples and more actions. Actions already implemented will be reused in different scenarios.</p>
<p>The implementation of the system will evolve, so will specifications, but this approach will ensure that test code is easy to maintain and focused on the business goal.</p>
<h1 id="bdd-with-cucumber">BDD with {cucumber}</h1>
<p>The steps of BDD with {cucumber} are the same as with base R. The difference in how we express specifications and their implementation.</p>
<p>The readability of specifications is given by them being expressed in <a href="https://cucumber.io/docs/gherkin/reference/">Gherkin</a> language. Specifications are no longer expressed in code, but as text. It adds another level of separation between the specification and the implementation.</p>
<p>We start by writing a feature file:</p>
<pre class="gherkin"><code># tests/acceptance/bookstore.feature
Feature: Bookstore
  Scenario: Adding a book to cart
    Given I am in the bookstore
    When I select &quot;The Hobbit, J.R.R. Tolkien&quot;
    When I add selected book to the cart
    Then I should see &quot;The Hobbit, J.R.R. Tolkien&quot; in the cart</code></pre>
<p>We implement actions with <code>given</code>, <code>when</code>, and <code>then</code> functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tests/acceptance/steps/steps.R</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">given</span>(<span class="st">&quot;I am in the bookstore&quot;</span>, <span class="cf">function</span>(context) {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">when</span>(<span class="st">&quot;I select {string}&quot;</span>, <span class="cf">function</span>(title, context) {</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  context<span class="sc">$</span>selected_id <span class="ot">&lt;-</span> <span class="fu">select_book</span>(title)<span class="sc">$</span>id</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">when</span>(<span class="st">&quot;I add selected book to the cart&quot;</span>, <span class="cf">function</span>(context) {</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_to_cart</span>(context<span class="sc">$</span>selected_id)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="fu">then</span>(<span class="st">&quot;I should see {string} in the cart&quot;</span>, <span class="cf">function</span>(title, context) {</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_in</span>(title, purrr<span class="sc">::</span><span class="fu">map_chr</span>(<span class="fu">get_cart</span>(), <span class="st">&quot;title&quot;</span>))</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
</div>
<p>This test does exactly the same as the test with base R.</p>
<p>We can run those tests with:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>cucumber<span class="sc">::</span><span class="fu">test</span>(<span class="st">&quot;tests/acceptance&quot;</span>, <span class="st">&quot;tests/acceptance/steps&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Test passed</span></span></code></pre></div>
<p>What <code>cucumber::test</code> function does is it reads the feature files, finds corresponding actions implementations and runs them in order. To learn more how it works, refer to <a href="https://jakubsob.github.io/cucumber/articles/how-it-works.html">How it works</a> vignette.</p>
<p>Similar to what we did with base R, we can extend the feature file with a scenario that checks if we can add multiple books to the cart:</p>
<pre class="gherkin"><code># tests/acceptance/bookstore.feature
Feature: Bookstore
  Scenario: Adding a book to cart
    Given I am in the bookstore
    When I select &quot;The Hobbit, J.R.R. Tolkien&quot;
    When I add selected book to the cart
    Then I should see &quot;The Hobbit, J.R.R. Tolkien&quot; in the cart

  Scenario: Adding multiple books to cart
    Given I am in the bookstore
    When I select &quot;The Hobbit, J.R.R. Tolkien&quot;
    When I add selected book to the cart
    When I select &quot;The Lord of the Rings, J.R.R. Tolkien&quot;
    When I add selected book to the cart
    Then I should see &quot;The Hobbit, J.R.R. Tolkien&quot; in the cart
    Then I should see &quot;The Lord of the Rings, J.R.R. Tolkien&quot; in the cart</code></pre>
<p>Reruning the tests will result in two scenarios passing.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>cucumber<span class="sc">::</span><span class="fu">test</span>(<span class="st">&quot;tests/acceptance&quot;</span>, <span class="st">&quot;tests/acceptance/steps&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Test passed</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Test passed</span></span></code></pre></div>
<h1 id="why-should-you-choose-cucumber">Why should you choose {cucumber}?</h1>
<ul>
<li>It allows you to start practicing BDD without having to figure out how to glue actions implementations on your own.</li>
<li>It allows you to express high-level tests in a natural language.</li>
<li>It helps you keep the separation between the specification and the implementation.</li>
<li>It helps you extend and reuse test code.</li>
</ul>
<h1 id="learning-bdd">Learning BDD</h1>
<ul>
<li>ATDD by Example: A Practical Guide to Acceptance Test-Driven Development: A Practical Guide to Acceptance TestDriven Development.</li>
<li><a href="https://www.youtube.com/watch?v=gXh0iUt4TXA&amp;list=PLwLLcwQlnXByKR1Fo7UnE6gQAbx-JfYJZ">Continuous Delivery Youtube Channel</a></li>
<li><a href="https://cucumber.io/docs/guides/">Cucumber</a></li>
</ul>





</body></html>